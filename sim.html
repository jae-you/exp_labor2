<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<style>
/* CSS ë™ì¼ */
* { box-sizing: border-box; margin: 0; padding: 0; }
html, body { height: 100%; background: #1e1e1e; color: #e0e0e0; font-family: sans-serif; overflow: hidden; }
#app { display: flex; height: 100vh; }
#ide { flex: 1; padding: 40px; display: flex; flex-direction: column; align-items: center; }
.opt-card { background: #333; padding: 20px; margin: 10px; cursor: pointer; border-radius: 8px; width: 250px; text-align: center; }
#deploy-btn { padding: 15px 50px; background: #28a745; color: white; border: none; border-radius: 8px; cursor: pointer; margin-top: 20px; font-weight: bold; }
#report { display: none; width: 100%; height: 100vh; background: #141414; padding: 50px; flex-direction: column; align-items: center; }
#final-btn { padding: 15px 40px; background: #007acc; color: white; border: none; border-radius: 8px; cursor: pointer; margin-top: 20px; }
</style>
</head>
<body>
<div id="app">
  <div id="ide">
    <h2 id="mod-title"></h2>
    <p id="mod-desc" style="color: #888; margin-bottom: 20px;"></p>
    <div id="opt-grid" style="display:flex;"></div>
    <button id="deploy-btn" onclick="doDeploy()">ğŸš€ Deploy Module</button>
  </div>
</div>
<div id="report">
  <h1>Simulation Analysis Complete</h1>
  <div id="rpt-persona" style="font-size:24px; color:#007acc; margin:30px 0;"></div>
  <p>ì„¤ê³„ ë°ì´í„°ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ê¸°ìˆ ì„œë¥¼ ì‘ì„±í•˜ë©´ ìµœì¢… ì €ì¥ë©ë‹ˆë‹¤.</p>
  <button id="final-btn" onclick="passToParent()">ì„¤ê³„ê¸°ìˆ ì„œ ì‘ì„±í•˜ëŸ¬ ê°€ê¸° (Phase 2) â†’</button>
</div>

<script>
var CONFIG = window.SIM_CONFIG || { userName: '' };
var TASKS = window.SIM_TASKS || [];
var step = 0; var deployHistory = []; var metrics = { agency: 0, inclusion: 0, sustain: 0, eff: 0 }; var selected = null;

function renderStep() {
  if (step >= TASKS.length) { showReport(); return; }
  var t = TASKS[step]; document.getElementById('mod-title').textContent = t.title; document.getElementById('mod-desc').textContent = t.desc;
  var g = document.getElementById('opt-grid'); g.innerHTML = '';
  t.options.forEach(o => {
    var c = document.createElement('div'); c.className = 'opt-card'; c.innerHTML = `<b>${o.label}</b>`;
    c.onclick = () => { document.querySelectorAll('.opt-card').forEach(x => x.style.border = 'none'); c.style.border = '2px solid #007acc'; selected = o; };
    g.appendChild(c);
  });
}
function doDeploy() {
  if (!selected) return;
  var t = TASKS[step]; metrics[t.metric] += selected.human; metrics.eff += selected.eff;
  deployHistory.push({ step: step + 1, choice: selected.label });
  step++; selected = null; renderStep();
}
function showReport() {
  document.getElementById('app').style.display = 'none'; document.getElementById('report').style.display = 'flex';
  document.getElementById('rpt-persona').textContent = "ì‹œìŠ¤í…œ ì•„í‚¤í…íŠ¸ ë¶„ì„ ì™„ë£Œ";
}
function passToParent() {
  // ë°ì´í„°ë¥¼ JSONí™”í•´ì„œ URL íŒŒë¼ë¯¸í„°ë¡œ ë¶€ëª¨(Streamlit)ì—ê²Œ ì „ë‹¬
  var simResult = JSON.stringify({ history: deployHistory, scores: metrics });
  window.parent.location.href = window.parent.location.pathname + "?sim_result=" + encodeURIComponent(simResult);
}
renderStep();
</script>
</body>
</html>
