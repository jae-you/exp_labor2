<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<style>
/* CSS ìŠ¤íƒ€ì¼ì€ ì´ì „ê³¼ ë™ì¼ */
* { box-sizing: border-box; margin: 0; padding: 0; }
html, body { height: 100%; background: #1e1e1e; color: #e0e0e0; font-family: sans-serif; overflow: hidden; }
#app { display: flex; height: 100vh; }
#messenger { width: 280px; background: #252526; border-right: 1px solid #333; display: flex; flex-direction: column; }
#chat-box { flex: 1; padding: 12px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; }
.msg { padding: 9px 12px; border-radius: 7px; font-size: 12px; }
.msg-client { background: #3a2e2e; } .msg-agent { background: #2e3a2e; }
#ide { flex: 1; display: flex; flex-direction: column; padding: 20px; }
#deploy-btn { padding: 15px; background: #28a745; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 10px; opacity: 0.5; }
#deploy-btn.ready { opacity: 1; }
#report { display: none; width: 100%; height: 100vh; background: #141414; padding: 50px; flex-direction: column; align-items: center; overflow-y: auto; }
#final-btn { padding: 15px 40px; background: #007acc; color: white; border: none; border-radius: 8px; cursor: pointer; margin-top: 20px; font-weight: bold; }
</style>
</head>
<body>

<div id="app">
  <div id="messenger"><div id="chat-box"></div></div>
  <div id="ide">
    <h2 id="mod-title"></h2>
    <p id="mod-desc"></p>
    <div id="opt-grid" style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; margin:20px 0;"></div>
    <button id="deploy-btn" onclick="doDeploy()">ğŸš€ Deploy Module</button>
  </div>
</div>

<div id="report">
  <h1>Architecture Impact Report</h1>
  <div id="rpt-name" style="margin-top:20px;"></div>
  <div id="rpt-persona" style="font-size:20px; font-weight:bold; color:#007acc; margin:20px 0;"></div>
  <p>ëª¨ë“  ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼ê°€ ìë™ìœ¼ë¡œ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
  <button id="final-btn" onclick="doSubmit()">ë‹¤ìŒ ë‹¨ê³„(Phase 2)ë¡œ ì´ë™í•˜ê¸°</button>
</div>

<script>
var CONFIG = window.SIM_CONFIG || { gasUrl: '', userName: '', survey: {} };
var TASKS = window.SIM_TASKS || [];
var step = 0;
var deployHistory = [];
var metrics = { agency: 0, inclusion: 0, sustain: 0, eff: 0, cost: 1000 };
var selected = null;

function renderStep() {
  if (step >= TASKS.length) { showReport(); return; }
  var t = TASKS[step];
  document.getElementById('mod-title').textContent = t.title;
  document.getElementById('mod-desc').textContent = t.desc;
  var g = document.getElementById('opt-grid'); g.innerHTML = '';
  t.options.forEach(opt => {
    var c = document.createElement('div');
    c.style.padding = '15px'; c.style.background = '#333'; c.style.cursor = 'pointer'; c.style.borderRadius = '8px';
    c.innerHTML = `<b>${opt.label}</b><br><small>${opt.desc}</small>`;
    c.onclick = () => {
      document.querySelectorAll('#opt-grid div').forEach(x => x.style.border = 'none');
      c.style.border = '2px solid #007acc'; selected = opt;
      document.getElementById('deploy-btn').classList.add('ready');
    };
    g.appendChild(c);
  });
}

function doDeploy() {
  if (!selected) return;
  var t = TASKS[step];
  metrics[t.metric] += selected.human;
  metrics.eff += selected.eff;
  deployHistory.push({ step: step + 1, choice: selected.label });
  step++; selected = null;
  document.getElementById('deploy-btn').classList.remove('ready');
  if (step === TASKS.length) { autoSave(); }
  renderStep();
}

// [ìë™ ì €ì¥] ë§ˆì§€ë§‰ ëª¨ë“ˆ ì„ íƒ ì‹œ ë°±ê·¸ë¼ìš´ë“œ ì „ì†¡
function autoSave() {
  var data = { userName: CONFIG.userName, survey: CONFIG.survey, history: deployHistory, scores: metrics, type: "SIM_COMPLETE" };
  var img = new Image();
  img.src = CONFIG.gasUrl + '?save=' + encodeURIComponent(JSON.stringify(data));
}

function showReport() {
  document.getElementById('app').style.display = 'none';
  document.getElementById('report').style.display = 'flex';
  document.getElementById('rpt-name').textContent = 'ì°¸ì—¬ì: ' + CONFIG.userName;
  document.getElementById('rpt-persona').textContent = 'ë¶„ì„ëœ ì•„í‚¤í…íŠ¸ ì„±í–¥: ê· í˜•ì£¼ì˜ì';
}

function doSubmit() {
  // í™•ì • ì „ì†¡ ë° í˜ì´ì§€ ì´ë™
  var data = { userName: CONFIG.userName, history: deployHistory, scores: metrics, is_final: true };
  var img = new Image();
  img.onload = img.onerror = () => {
    window.parent.postMessage({ type: 'GOTO_PHASE2' }, '*');
  };
  img.src = CONFIG.gasUrl + '?save=' + encodeURIComponent(JSON.stringify(data));
}

renderStep();
</script>
</body>
</html>
