<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<style>
body { background: #1e1e1e; color: #e0e0e0; font-family: sans-serif; padding: 20px; }
.opt-card { background: #333; padding: 20px; margin: 10px 0; cursor: pointer; border-radius: 8px; border: 1px solid #444; }
.opt-card:hover { border-color: #007acc; }
#deploy-btn { padding: 15px 40px; background: #28a745; color: white; border: none; border-radius: 8px; cursor: pointer; margin-top: 20px; font-weight: bold; }
#report { display: none; text-align: center; margin-top: 100px; }
</style>
</head>
<body>
<div id="app">
  <h2 id="mod-title"></h2>
  <p id="mod-desc" style="color:#aaa;"></p>
  <div id="opt-grid"></div>
  <button id="deploy-btn" onclick="doDeploy()">ğŸš€ Deploy Module</button>
</div>
<div id="report">
  <h1 style="color:#007acc;">ë¶„ì„ ì™„ë£Œ</h1>
  <p>ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„°ê°€ ì •ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
  <p>ì ì‹œ í›„ ë‹¤ìŒ ë‹¨ê³„(Phase 2)ë¡œ ìë™ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤...</p>
</div>
<script>
var CONFIG = window.SIM_CONFIG || { userName: '' };
var TASKS = window.SIM_TASKS || [];
var step = 0; var history = []; var metrics = { agency: 0, inclusion: 0, sustain: 0, eff: 0 }; var selected = null;

function renderStep() {
  if (step >= TASKS.length) { finishSim(); return; }
  var t = TASKS[step]; document.getElementById('mod-title').textContent = t.title;
  document.getElementById('mod-desc').textContent = t.desc;
  var g = document.getElementById('opt-grid'); g.innerHTML = '';
  t.options.forEach(o => {
    var c = document.createElement('div'); c.className = 'opt-card'; c.innerHTML = `<b>${o.label}</b><br><small>${o.desc}</small>`;
    c.onclick = () => { document.querySelectorAll('.opt-card').forEach(x=>x.style.borderColor='#444'); c.style.borderColor='#007acc'; selected=o; };
    g.appendChild(c);
  });
}
function doDeploy() {
  if(!selected) return;
  var t = TASKS[step]; metrics[t.metric] += selected.human; metrics.eff += selected.eff;
  history.push({ step: step + 1, choice: selected.label });
  step++; selected = null; renderStep();
}
function finishSim() {
  document.getElementById('app').style.display = 'none';
  document.getElementById('report').style.display = 'block';
  var simResult = JSON.stringify({ history: history, scores: metrics });
  setTimeout(() => {
    window.parent.location.href = window.parent.location.pathname + "?sim_result=" + encodeURIComponent(simResult);
  }, 1500);
}
renderStep();
</script>
</body>
</html>
